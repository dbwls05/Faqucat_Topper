<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파쿠켓 - 고양이 파쿠르 게임</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #f5f5f5 0%, #dcdcdc 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
}

.container {
    display: flex;
    gap: 20px;
    padding: 20px;
    max-width: 1400px;
    width: 100%;
}

.ad-space {
    width: 200px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.ad-box {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    color: #333;
    min-height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ccc;
}

.game-container {
    flex: 1;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.screen {
    display: none;
}

.screen.active {
    display: block;
}

h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
    font-size: 2.5em;
}

.menu-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 300px;
    margin: 50px auto;
}

button {
    padding: 15px 30px;
    font-size: 1.2em;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
}

.btn-primary {
    background: #333;
    color: white;
}

.btn-primary:hover {
    background: #555;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.btn-secondary {
    background: #f2f2f2;
    color: #333;
    border: 1px solid #ccc;
}

.btn-secondary:hover {
    background: #e0e0e0;
}

.stage-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 15px;
    margin: 30px 0;
}

.stage-button {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 5px;
    font-size: 1.5em;
    position: relative;
}

.stars {
    display: flex;
    gap: 3px;
    font-size: 0.6em;
}

.star {
    color: #999;
}

.star.empty {
    color: #ccc;
}

canvas {
    border: 3px solid #333;
    display: block;
    margin: 20px auto;
    background: #f0f0f0;
}

.game-ui {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.timer, .stars-collected {
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
}

.controls-info {
    background: #f7f7f7;
    padding: 15px;
    border-radius: 10px;
    margin-top: 20px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    border: 1px solid #ddd;
}

.control-set {
    text-align: center;
}

.control-set h3 {
    margin-bottom: 10px;
    color: #444;
}

.settings-panel {
    max-width: 400px;
    margin: 0 auto;
}

.setting-item {
    margin: 30px 0;
}

.setting-item label {
    display: block;
    margin-bottom: 10px;
    font-weight: bold;
    color: #333;
}

input[type="range"] {
    width: 100%;
    height: 8px;
    border-radius: 5px;
    background: #ddd;
    outline: none;
}

.back-button {
    margin-top: 30px;
}

.game-over-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.game-over-modal.active {
    display: flex;
}

.modal-content {
    background: #fff;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
}

.modal-content h2 {
    color: #333;
    margin-bottom: 20px;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}
</style>
</head>
<body>
    <div class="container">
        <div class="ad-space">
            <div class="ad-box">광고 공간 1</div>
            <div class="ad-box">광고 공간 2</div>
        </div>

        <div class="game-container">
            <!-- 시작 화면 -->
            <div id="mainMenu" class="screen active">
                <h1>🐱 파쿠켓 🐱</h1>
                <div class="menu-buttons">
                    <button class="btn-primary" onclick="showScreen('stageSelect')">시작</button>
                    <button class="btn-primary" onclick="showScreen('ranking')">랭킹</button>
                    <button class="btn-primary" onclick="showScreen('settings')">설정</button>
                </div>
            </div>

            <!-- 스테이지 선택 화면 -->
            <div id="stageSelect" class="screen">
                <h1>스테이지 선택</h1>
                <div class="stage-grid" id="stageGrid"></div>
                <button class="btn-secondary back-button" onclick="showScreen('mainMenu')">돌아가기</button>
            </div>

            <!-- 설정 화면 -->
            <div id="settings" class="screen">
                <h1>설정</h1>
                <div class="settings-panel">
                    <div class="setting-item">
                        <label for="volumeSlider">배경음 볼륨</label>
                        <input type="range" id="volumeSlider" min="0" max="100" value="50">
                        <p style="text-align: center; margin-top: 10px;">볼륨: <span id="volumeValue">50</span>%</p>
                    </div>
                    <div class="setting-item">
                        <button class="btn-primary" style="width: 100%;">로그인 (추후 구현)</button>
                    </div>
                </div>
                <button class="btn-secondary back-button" onclick="showScreen('mainMenu')">돌아가기</button>
            </div>

            <!-- 랭킹 화면 -->
            <div id="ranking" class="screen">
                <h1>랭킹</h1>
                <p style="text-align: center; margin: 50px 0; color: #666;">랭킹 시스템은 추후 구현 예정입니다.</p>
                <button class="btn-secondary back-button" onclick="showScreen('mainMenu')">돌아가기</button>
            </div>

            <!-- 게임 화면 -->
            <div id="gameScreen" class="screen">
                <div class="game-ui">
                    <button class="btn-secondary" onclick="showScreen('stageSelect')">← 나가기</button>
                    <div class="timer">시간: <span id="timeDisplay">0:00</span></div>
                    <div class="stars-collected">별: <span id="starsDisplay">0/3</span></div>
                </div>
                <canvas id="gameCanvas" width="800" height="600"></canvas>
                <div class="controls-info">
                    <div class="control-set">
                        <h3>🔥 불 고양이</h3>
                        <p>W: 점프</p>
                        <p>A: 왼쪽</p>
                        <p>S: 아래</p>
                        <p>D: 오른쪽</p>
                    </div>
                    <div class="control-set water">
                        <h3>💧 물 고양이</h3>
                        <p>↑: 점프</p>
                        <p>←: 왼쪽</p>
                        <p>↓: 아래</p>
                        <p>→: 오른쪽</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="ad-space">
            <div class="ad-box">광고 공간 3</div>
            <div class="ad-box">광고 공간 4</div>
        </div>
    </div>

    <!-- 게임 오버 모달 -->
    <div id="gameOverModal" class="game-over-modal">
        <div class="modal-content">
            <h2 id="modalTitle">게임 클리어!</h2>
            <p id="modalMessage">축하합니다!</p>
            <div id="modalStars" class="stars" style="justify-content: center; font-size: 2em; margin: 20px 0;"></div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal(); showScreen('stageSelect')">스테이지 선택</button>
                <button class="btn-primary" onclick="closeModal(); restartGame()">다시 시작</button>
            </div>
        </div>
    </div>

    <script>
        // 게임 상태 관리
        const gameState = {
            currentStage: 1,
            stageProgress: JSON.parse(localStorage.getItem('stageProgress')) || {},
            volume: 50
        };

        // 화면 전환
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'stageSelect') {
                renderStages();
            } else if (screenId === 'gameScreen') {
                startGame();
            }
        }

        // 스테이지 렌더링
        function renderStages() {
            const grid = document.getElementById('stageGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 10; i++) {
                const btn = document.createElement('button');
                btn.className = 'btn-primary stage-button';
                btn.innerHTML = `
                    <span>Stage ${i}</span>
                    <div class="stars">
                        ${renderStageStars(i)}
                    </div>
                `;
                btn.onclick = () => {
                    gameState.currentStage = i;
                    showScreen('gameScreen');
                };
                grid.appendChild(btn);
            }
        }

        function renderStageStars(stageNum) {
            const stars = gameState.stageProgress[stageNum] || 0;
            let html = '';
            for (let i = 0; i < 3; i++) {
                html += `<span class="star ${i < stars ? '' : 'empty'}">★</span>`;
            }
            return html;
        }

        // 볼륨 조절
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        volumeSlider.addEventListener('input', (e) => {
            gameState.volume = e.target.value;
            volumeValue.textContent = e.target.value;
        });

        // 게임 로직
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let game = {
            fireCat: { x: 50, y: 500, width: 30, height: 30, vx: 0, vy: 0, onGround: false },
            waterCat: { x: 720, y: 500, width: 30, height: 30, vx: 0, vy: 0, onGround: false },
            platforms: [],
            hazards: [],
            stars: [],
            goals: [],
            keys: {},
            gravity: 0.5,
            jumpPower: -12,
            moveSpeed: 5,
            gameStartTime: 0,
            starsCollected: 0,
            fireCatFinished: false,
            waterCatFinished: false
        };

        // 스테이지 데이터
        const stages = {
            1: {
                platforms: [
                    { x: 0, y: 580, width: 800, height: 20 },
                    { x: 200, y: 480, width: 150, height: 20 },
                    { x: 450, y: 400, width: 150, height: 20 },
                    { x: 300, y: 320, width: 200, height: 20 }
                ],
                hazards: [
                    { x: 100, y: 550, width: 80, height: 30, type: 'water' },
                    { x: 600, y: 550, width: 80, height: 30, type: 'lava' }
                ],
                stars: [
                    { x: 275, y: 450, collected: false },
                    { x: 525, y: 370, collected: false },
                    { x: 400, y: 290, collected: false }
                ],
                goals: [
                    { x: 320, y: 280, type: 'fire' },
                    { x: 460, y: 280, type: 'water' }
                ]
            },
            2: {
                platforms: [
                    { x: 0, y: 580, width: 800, height: 20 },
                    { x: 100, y: 500, width: 100, height: 20 },
                    { x: 300, y: 420, width: 100, height: 20 },
                    { x: 500, y: 340, width: 100, height: 20 },
                    { x: 350, y: 260, width: 100, height: 20 }
                ],
                hazards: [
                    { x: 0, y: 550, width: 80, height: 30, type: 'water' },
                    { x: 720, y: 550, width: 80, height: 30, type: 'lava' },
                    { x: 220, y: 490, width: 60, height: 10, type: 'lava' }
                ],
                stars: [
                    { x: 350, y: 390, collected: false },
                    { x: 550, y: 310, collected: false },
                    { x: 400, y: 230, collected: false }
                ],
                goals: [
                    { x: 370, y: 220, type: 'fire' },
                    { x: 410, y: 220, type: 'water' }
                ]
            }
        };

        // 키 입력 처리
        document.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });

      let gameRunning = false;
        let animationId = null;

        function startGame() {
            const stageData = stages[gameState.currentStage] || stages[1];
            
            game = {
                fireCat: { x: 50, y: 500, width: 30, height: 30, vx: 0, vy: 0, onGround: false },
                waterCat: { x: 720, y: 500, width: 30, height: 30, vx: 0, vy: 0, onGround: false },
                platforms: JSON.parse(JSON.stringify(stageData.platforms)),
                hazards: JSON.parse(JSON.stringify(stageData.hazards)),
                stars: JSON.parse(JSON.stringify(stageData.stars)),
                goals: JSON.parse(JSON.stringify(stageData.goals)),
                keys: {},
                gravity: 0.5,
                jumpPower: -12,
                moveSpeed: 5,
                gameStartTime: Date.now(),
                starsCollected: 0,
                fireCatFinished: false,
                waterCatFinished: false
            };
            
            // 게임 루프 시작
            if (!gameRunning) {
                gameRunning = true;
                gameLoop();
            }
        }

        function restartGame() {
            gameRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            setTimeout(() => {
                startGame();
            }, 100);
        }

        function gameLoop() {
            if (!gameRunning) return;
            update();
            render();
            animationId = requestAnimationFrame(gameLoop);
        }

    // 최초 1회만 루프 실행
    gameRunning = true;
    gameLoop();
        function update() {
            // 불 고양이 조작 (WASD)
            updateCat(game.fireCat, 'w', 'a', 'd');
            
            // 물 고양이 조작 (화살표)
            updateCat(game.waterCat, 'ArrowUp', 'ArrowLeft', 'ArrowRight');

            // 충돌 감지
            checkCollisions();

            // 타이머 업데이트
            updateTimer();

            // 게임 클리어 체크
            checkWinCondition();
        }

        function updateCat(cat, jumpKey, leftKey, rightKey) {
            // 좌우 이동
            cat.vx = 0;
            if (game.keys[leftKey]) cat.vx = -game.moveSpeed;
            if (game.keys[rightKey]) cat.vx = game.moveSpeed;

            // 점프
            if (game.keys[jumpKey] && cat.onGround) {
                cat.vy = game.jumpPower;
                cat.onGround = false;
            }

            // 중력 적용
            cat.vy += game.gravity;

            // 위치 업데이트
            cat.x += cat.vx;
            cat.y += cat.vy;

            // 화면 경계
            if (cat.x < 0) cat.x = 0;
            if (cat.x + cat.width > canvas.width) cat.x = canvas.width - cat.width;

            // 플랫폼 충돌
            cat.onGround = false;
            game.platforms.forEach(platform => {
                if (cat.x < platform.x + platform.width &&
                    cat.x + cat.width > platform.x &&
                    cat.y + cat.height > platform.y &&
                    cat.y + cat.height < platform.y + platform.height &&
                    cat.vy >= 0) {
                    cat.y = platform.y - cat.height;
                    cat.vy = 0;
                    cat.onGround = true;
                }
            });
        }

        function checkCollisions() {
            // 별 수집
            game.stars.forEach(star => {
                if (!star.collected) {
                    if (checkOverlap(game.fireCat, star, 20, 20) || 
                        checkOverlap(game.waterCat, star, 20, 20)) {
                        star.collected = true;
                        game.starsCollected++;
                        document.getElementById('starsDisplay').textContent = `${game.starsCollected}/3`;
                    }
                }
            });

            // 장애물 충돌
            game.hazards.forEach(hazard => {
                if (hazard.type === 'water' && checkOverlap(game.fireCat, hazard, hazard.width, hazard.height)) {
                    gameOver('불 고양이가 물에 닿았습니다!');
                }
                if (hazard.type === 'lava' && checkOverlap(game.waterCat, hazard, hazard.width, hazard.height)) {
                    gameOver('물 고양이가 용암에 닿았습니다!');
                }
            });

            // 도착 지점
            game.goals.forEach(goal => {
                if (goal.type === 'fire' && checkOverlap(game.fireCat, goal, 30, 40)) {
                    game.fireCatFinished = true;
                }
                if (goal.type === 'water' && checkOverlap(game.waterCat, goal, 30, 40)) {
                    game.waterCatFinished = true;
                }
            });
        }

        function checkOverlap(cat, obj, width, height) {
            return cat.x < obj.x + width &&
                   cat.x + cat.width > obj.x &&
                   cat.y < obj.y + height &&
                   cat.y + cat.height > obj.y;
        }

        function checkWinCondition() {
            if (game.fireCatFinished && game.waterCatFinished) {
                stageClear();
                gameRunning = false;
            }
        }

        function gameOver(message) {
            showModal('게임 오버!', message, 0);
        }

        function stageClear() {
            const stars = game.starsCollected;
            const currentBest = gameState.stageProgress[gameState.currentStage] || 0;
            
            if (stars > currentBest) {
                gameState.stageProgress[gameState.currentStage] = stars;
                localStorage.setItem('stageProgress', JSON.stringify(gameState.stageProgress));
            }

            showModal('스테이지 클리어!', `획득한 별: ${stars}/3`, stars);
        }

        function showModal(title, message, stars) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const starsHtml = document.getElementById('modalStars');
            starsHtml.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const star = document.createElement('span');
                star.className = `star ${i < stars ? '' : 'empty'}`;
                star.textContent = '★';
                starsHtml.appendChild(star);
            }
            
            document.getElementById('gameOverModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('gameOverModal').classList.remove('active');
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - game.gameStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timeDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function render() {
            // 배경
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 플랫폼
            ctx.fillStyle = '#95a5a6';
            game.platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // 장애물
            game.hazards.forEach(hazard => {
                ctx.fillStyle = hazard.type === 'water' ? '#3498db' : '#e74c3c';
                ctx.fillRect(hazard.x, hazard.y, hazard.width, hazard.height);
            });

            // 별
            game.stars.forEach(star => {
                if (!star.collected) {
                    ctx.fillStyle = '#f1c40f';
                    ctx.beginPath();
                    ctx.arc(star.x + 10, star.y + 10, 10, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // 도착 지점
            game.goals.forEach(goal => {
                ctx.fillStyle = goal.type === 'fire' ? '#e74c3c' : '#3498db';
                ctx.fillRect(goal.x, goal.y, 30, 40);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('🏁', goal.x + 5, goal.y + 28);
            });

            // 고양이들
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(game.fireCat.x, game.fireCat.y, game.fireCat.width, game.fireCat.height);
            
            ctx.fillStyle = '#3498db';
            ctx.fillRect(game.waterCat.x, game.waterCat.y, game.waterCat.width, game.waterCat.height);
        }

        // 초기화
        renderStages();
    </script>
</body>
</html>